<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netim Paneli | Minemsiyle</title>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --bg-body: #0f0f13;
            /* Ã‡ok koyu, hafif maviye Ã§alan siyah */
            --bg-panel: #18181b;
            /* Panel arka planÄ± */
            --bg-input: #27272a;
            /* Input arka planÄ± */
            --border-color: #2e2e33;
            /* Ã‡erÃ§eve rengi */
            --accent: #d4a373;
            /* Senin Gold rengin */
            --accent-hover: #eac094;
            --text-main: #e4e4e7;
            --text-muted: #a1a1aa;
            --danger: #ef4444;
            --success: #10b981;
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px;
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding: 0 12px;
            color: var(--accent);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: var(--radius);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .menu-item i {
            font-size: 1.4rem;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.03);
            color: var(--text-main);
        }

        .menu-item.active {
            background-color: var(--accent);
            color: #000;
            /* Gold Ã¼zerinde siyah yazÄ± okunur */
            box-shadow: 0 4px 20px rgba(212, 163, 115, 0.3);
        }

        .logout-btn {
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px;
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: var(--radius);
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 {
            font-weight: 600;
            font-size: 1.8rem;
        }

        .breadcrumb {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .view-section {
            display: none;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .view-section.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- CARDS & FORMS --- */
        .card {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Form Grid YapÄ±sÄ± */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-grid.full {
            grid-column: span 2;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            background-color: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            transition: 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.1);
        }

        .action-btn {
            background-color: var(--accent);
            color: #121212;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .action-btn:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* --- TABLES --- */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: #202024;
        }

        th {
            text-align: left;
            padding: 16px;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            color: var(--text-main);
            font-size: 0.95rem;
        }

        tr:hover td {
            background-color: rgba(255, 255, 255, 0.02);
        }

        /* =========================================
   ğŸ–ï¸ GELÄ°ÅMÄ°Å ROZET SÄ°STEMÄ° (V2)
   ========================================= */

        /* Rozetlerin Genel YapÄ±sÄ± */
        .custom-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            /* Alt satÄ±ra kaymasÄ±n */
        }

        .custom-badge:hover {
            transform: scale(1.1) translateY(-2px);
            /* BÃ¼yÃ¼ ve yukarÄ± zÄ±pla */
            cursor: default;
            z-index: 10;
            /* DiÄŸerlerinin Ã¼stÃ¼ne Ã§Ä±ksÄ±n */
        }

        /* --- ğŸŒˆ RENK PALETÄ° --- */

        /* ğŸ›¡ï¸ YÃ–NETÄ°CÄ° (YeÅŸil Enerji) */
        .badge-admin-role {
            background: linear-gradient(135deg, #059669, #10b981, #34d399);
            background-size: 200%;
        }

        .badge-admin-role:hover {
            animation: shine 1.5s infinite linear;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
            /* YeÅŸil IÅŸÄ±k */
        }

        /* ğŸ”¨ MODERATÃ–R (Turuncu AteÅŸ) */
        .badge-mod {
            background: linear-gradient(135deg, #d97706, #f59e0b, #fbbf24);
            background-size: 200%;
        }

        .badge-mod:hover {
            animation: shine 1.5s infinite linear;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.6);
            /* Turuncu IÅŸÄ±k */
        }

        /* ğŸ’» GELÄ°ÅTÄ°RÄ°CÄ° (KÄ±rmÄ±zÄ± Neon - Matrix) */
        .badge-dev {
            background: linear-gradient(135deg, #dc2626, #ef4444, #f87171);
            background-size: 200%;
        }

        .badge-dev:hover {
            animation: shine 1s infinite linear;
            /* Bu daha hÄ±zlÄ± aksÄ±n */
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.7);
            /* KÄ±rmÄ±zÄ± Neon */
        }

        /* ğŸŒŸ VIP (AltÄ±n - Zaten yapmÄ±ÅŸtÄ±k ama buraya da koyalÄ±m tam olsun) */
        .badge-vip {
            background: linear-gradient(45deg, #FFD700, #FDB931, #FFD700);
            background-size: 200%;
            color: #5a3e02;
            border: 1px solid #ffeeba;
        }

        .badge-vip:hover {
            animation: shine 1s infinite linear;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            /* Ã‡ok parlak sarÄ± */
        }

        .badge-supporter {
            background: linear-gradient(135deg, #db2777, #ec4899);
            color: #fff;
        }

        /* Pembe */
        .badge-verified {
            background: #0ea5e9;
            color: #fff;
        }

        /* Mavi Tik */

        /* ğŸ–‹ï¸ YAZAR (MÃ¼rekkep Moru BÃ¼yÃ¼sÃ¼) */
        .badge-writer {
            background: linear-gradient(135deg, #4f46e5, #6366f1, #818cf8);
            background-size: 200%;
        }

        .badge-writer:hover {
            animation: shine 2s infinite linear;
            /* Daha aÄŸÄ±r, asil aksÄ±n */
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
            /* Mor IÅŸÄ±k */
        }

        /* Ä°ndigo */
        .badge-poet {
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
            color: #fff;
        }

        /* Mor */

        /* ğŸ BUG AVCISI (Teal - Siber) */
        .badge-bug {
            background: linear-gradient(135deg, #0f766e, #14b8a6, #2dd4bf);
            background-size: 200%;
        }

        .badge-bug:hover {
            animation: shine 1.5s infinite linear;
            box-shadow: 0 0 15px rgba(20, 184, 166, 0.6);
        }

        /* Teal */
        .badge-bookworm {
            background: #65a30d;
            color: #fff;
        }

        /* Ã‡imen YeÅŸili */
        .badge-coffee {
            background: #78350f;
            color: #fff;
            border: 1px solid #92400e;
        }

        /* Kahve */
        .badge-cat {
            background: #4b5563;
            color: #fff;
        }

        /* Gri */

        /* âœ¨ Parlama Animasyonu */
        @keyframes shine {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* --- ğŸ“¦ MODAL Ä°Ã‡Ä° DÃœZEN (IZGARA SÄ°STEMÄ°) --- */
        /* Bu kÄ±sÄ±m modalÄ±n iÃ§indeki listeyi gÃ¼zelleÅŸtirir */

        #badgeOptionsList {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* Yan yana 2 tane */
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            /* Ã‡ok fazla olursa kaydÄ±r */
            padding-right: 5px;
        }

        .badge-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .badge-option:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .badge-option.selected {
            background: rgba(99, 102, 241, 0.15);
            /* SeÃ§ilince hafif mor olsun */
            border-color: #6366f1;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.2);
        }

        /* Telefondan girince tek sÃ¼tuna dÃ¼ÅŸsÃ¼n */
        @media (max-width: 480px) {
            #badgeOptionsList {
                grid-template-columns: 1fr;
            }
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            background: radial-gradient(circle at center, #1f1f23 0%, #0f0f13 100%);
        }

        /* --- TOAST NOTIFICATION (Alert Yerine) --- */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-panel);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            min-width: 300px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* --- DASHBOARD WIDGETS --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-panel);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(212, 163, 115, 0.1);
            color: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: white;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(24px);
        }

        /* =========================================
   MODERN DOSYA YÃœKLEME ALANI
   ========================================= */

        /* 1. GerÃ§ek inputu tamamen gizle (Yer kaplamasÄ±n) */
        .file-input-hidden {
            display: none;
        }

        /* 2. Yeni yÃ¼kleme alanÄ±nÄ±n tasarÄ±mÄ± */
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            /* Ä°kon ile yazÄ± arasÄ± boÅŸluk */
            width: 100%;
            padding: 25px;
            /* YÃ¼ksekliÄŸi belirler */

            /* Koyu tema arka planÄ± (DiÄŸer inputlarla uyumlu) */
            background: rgba(255, 255, 255, 0.05);

            /* Kesik Ã§izgili (Dashed) modern kenarlÄ±k */
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            /* Yuvarlak kÃ¶ÅŸeler */

            color: var(--muted);
            /* Silik yazÄ± rengi */
            font-weight: 500;
            cursor: pointer;
            /* TÄ±klanabilir olduÄŸunu gÃ¶ster */
            transition: all 0.3s ease;
            /* YumuÅŸak geÃ§iÅŸ efekti */
        }

        /* Ä°konun boyutu */
        .file-upload-label i {
            font-size: 1.8rem;
            color: var(--accent);
            /* Vurgu rengi (SarÄ±/Turuncu neyse) */
        }

        /* 3. Mouse Ã¼zerine gelince (Hover Efekti) */
        .file-upload-label:hover {
            background: rgba(255, 255, 255, 0.08);
            /* Biraz daha aydÄ±nlÄ±k */
            border-color: var(--accent);
            /* KenarlÄ±k vurgu rengi olsun */
            color: var(--ink);
            /* YazÄ± netleÅŸsin */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            /* Hafif gÃ¶lge */
        }

        /* --- MODAL (GÃœNCELLENMÄ°Å VERSÄ°YON) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            /* ArkasÄ± hafif kararsÄ±n */

            /* ğŸ‘‡ Ä°ÅTE SÄ°HÄ°R BURADA: BaÅŸlangÄ±Ã§ta YOK ET */
            display: none;

            justify-content: center;
            align-items: center;
            z-index: 9999;
            /* En Ã¼stte olsun */
            /* backdrop-filter: blur(5px); */
            /* ArkasÄ± buzlu cam gibi olsun */
        }

        /* Sadece "open" sÄ±nÄ±fÄ± eklenince gÃ¶rÃ¼nÃ¼r olsun */
        .modal-overlay.open {
            display: flex !important;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* =============================================================
   ğŸ“± MODERN MOBÄ°L ARAYÃœZ (HAMBURGER YOK - ALT MENÃœ VAR)
   ============================================================= */

        @media (max-width: 768px) {

            /* 1. SIDEBAR -> ALT MENÃœYE DÃ–NÃœÅSÃœN */
            .sidebar {
                position: fixed !important;
                top: auto !important;
                /* Ãœstten kopar */
                bottom: 0 !important;
                /* Alta yapÄ±ÅŸtÄ±r */
                left: 0 !important;
                width: 100% !important;
                /* EkranÄ± kapla */
                height: 65px !important;
                /* Standart bar yÃ¼ksekliÄŸi */
                flex-direction: row !important;
                /* Yan yana diz */
                justify-content: space-around;
                /* EÅŸit daÄŸÄ±t */
                align-items: center;
                padding: 0 10px !important;
                border-right: none !important;
                border-top: 1px solid #333;
                /* ÃœstÃ¼ne Ã§izgi Ã§ek */
                z-index: 5000;
                /* En Ã¼stte */
                background-color: #111;
                /* Renk */
                box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
                /* GÃ¶lge yukarÄ± vursun */
            }

            /* 2. GEREKSÄ°ZLERÄ° GÄ°ZLE (Mobilde Logo ve YazÄ±lar FazlalÄ±k) */
            .sidebar .brand {
                display: none !important;
                /* Logoyu gizle */
            }

            .sidebar .menu-item {
                flex-direction: column;
                /* Ä°kon Ã¼stte, yazÄ± altta (veya gizli) */
                justify-content: center;
                padding: 5px !important;
                margin: 0 !important;
                background: transparent !important;
                /* Arka planÄ± kaldÄ±r */
                border: none !important;
                font-size: 0.7rem;
                /* YazÄ±yÄ± kÃ¼Ã§Ã¼lt */
                gap: 2px;
            }

            /* Ä°konlarÄ± bÃ¼yÃ¼t, parmakla basmasÄ± kolay olsun */
            .sidebar .menu-item i {
                font-size: 1.4rem !important;
                margin-bottom: 2px;
            }

            /* Ã‡Ä±kÄ±ÅŸ Butonunu Ä°kona Ã‡evir (Yer KaplamasÄ±n) */
            .logout-btn {
                width: auto !important;
                background: transparent !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 0 !important;
                /* YazÄ±sÄ±nÄ± gizle */
            }

            .logout-btn i {
                font-size: 1.4rem !important;
                /* Sadece ikon kalsÄ±n */
                color: #ef4444;
            }

            /* 3. ANA Ä°Ã‡ERÄ°ÄÄ° DÃœZELT */
            .main-content {
                margin-left: 0 !important;
                /* Soldaki boÅŸluÄŸu sil */
                width: 100% !important;
                padding: 15px !important;
                padding-bottom: 80px !important;
                /* Alt menÃ¼ iÃ§erik kapatmasÄ±n diye boÅŸluk */
            }

            /* 4. FORMLAR VE TABLOLAR (SÄ±kÄ±ÅŸmayÄ± Ã–nle) */
            .card {
                padding: 15px !important;
            }

            /* Form elemanlarÄ±nÄ± alt alta al */
            form div,
            .input-group,
            .row {
                flex-direction: column !important;
                width: 100% !important;
            }

            input,
            select,
            textarea,
            button {
                width: 100% !important;
            }

            /* Tabloyu kaydÄ±rÄ±labilir yap */
            .table-container {
                display: block;
                width: 100%;
                overflow-x: auto;
            }
        }

        /* --- MOBÄ°LDE AYARLAR KUTUSU DÃœZELTMESÄ° --- */
        @media (max-width: 768px) {

            /* Ayarlar kartÄ±nÄ± esnek yap */
            .setting-card {
                display: flex !important;
                flex-direction: row !important;
                /* Yan yana kalsÄ±nlar */
                justify-content: space-between !important;
                /* Biri saÄŸa biri sola */
                align-items: center !important;
                flex-wrap: nowrap !important;
                /* Asla alt satÄ±ra atmasÄ±n */
                gap: 15px;
                /* Arada boÅŸluk */
                overflow: hidden;
                /* TaÅŸarsa gizle (ama taÅŸmayacak) */
            }

            /* YazÄ± Ã§ok uzunsa Ã¼Ã§ nokta (...) koy, butonu itmesin */
            .setting-card h3,
            .setting-card p {
                flex: 1;
                /* Kalan boÅŸluÄŸu doldur */
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                margin: 0 !important;
                font-size: 0.9rem !important;
                /* Mobilde yazÄ±yÄ± bir tÄ±k kÃ¼Ã§Ã¼lt */
            }

            /* Toggle Switch'in kendisini saÄŸa sabitle */
            .switch {
                flex-shrink: 0;
                /* Asla bÃ¼zÃ¼ÅŸme! */
                margin-left: auto;
            }
        }

        /* ğŸ” GÄ°RÄ°Å EKRANI AÃ‡IKKEN SÄ°DEBAR'I GÄ°ZLE */
        #login-screen:not([style*="display: none"])~.sidebar {
            display: none !important;
        }

        /* --- MODAL DÃœZELTMESÄ° (Kesin Ã‡Ã¶zÃ¼m) --- */
        #badgeModal {
            display: none !important;
            /* VarsayÄ±lan olarak KESÄ°NLÄ°KLE gizle */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        /* Sadece 'open' sÄ±nÄ±fÄ± eklenince gÃ¶rÃ¼nÃ¼r olsun */
        #badgeModal.open {
            display: flex !important;
            opacity: 1;
            visibility: visible;
        }

        /* --- MODERN HAREKET GEÃ‡MÄ°ÅÄ° (ACTIVITY FEED) --- */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            /* Ã‡ok uzarsa kaydÄ±rma Ã§ubuÄŸu Ã§Ä±ksÄ±n */
            padding-right: 10px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-body);
            /* Arka plan rengi */
            border-radius: 12px;
            border-left: 4px solid var(--border);
            transition: all 0.2s ease;
        }

        .activity-item:hover {
            transform: translateX(5px);
            background: var(--bg-card);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Ä°kon Kutusu */
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #fff;
            flex-shrink: 0;
        }

        /* Renk KodlarÄ± */
        .act-blog {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%);
            border-left-color: #ff9a9e;
        }

        .act-user {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            border-left-color: #a18cd1;
        }

        .act-login {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-left-color: #84fab0;
        }

        .activity-details {
            flex: 1;
        }

        .activity-title {
            font-weight: bold;
            color: var(--ink);
            margin-bottom: 4px;
            display: block;
        }

        .activity-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .activity-time {
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* --- HAREKETLER KUTUSU Ã‡ERÃ‡EVESÄ° (Yeni) --- */
        .dashboard-card {
            background: #1e1e1e;
            /* Koyu kart rengi */
            border: 1px solid #333;
            /* Ä°nce gri Ã§erÃ§eve */
            border-radius: 16px;
            /* KÃ¶ÅŸeleri yuvarla */
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            /* Hafif gÃ¶lge */
            position: relative;
            /* Buton yerleÅŸimi iÃ§in */
            overflow: hidden;
        }

        /* Kart BaÅŸlÄ±ÄŸÄ± (BaÅŸlÄ±k ve Buton Yan Yana) */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            /* BaÅŸlÄ±k altÄ± Ã§izgi */
        }

        .card-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- YENÄ°LE BUTONU (Refresh Btn) --- */
        .refresh-btn {
            background: #2a2a2a;
            /* Buton rengi */
            color: #fff;
            border: 1px solid #444;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: var(--accent);
            /* Varsa tema rengin */
            border-color: var(--accent);
            color: #000;
            /* YazÄ± rengi siyah olsun okunsun */
            transform: rotate(2deg) scale(1.05);
            /* Ufak animasyon */
        }

        .refresh-btn:active {
            transform: scale(0.95);
        }

        /* Liste alanÄ± taÅŸmasÄ±n */
        .recent-activities-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Scrollbar (KaydÄ±rma Ã‡ubuÄŸu) GÃ¼zelleÅŸtirme */
        .recent-activities-list::-webkit-scrollbar {
            width: 6px;
        }

        .recent-activities-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .recent-activities-list::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <div id="toast-container"></div>

    <div id="login-screen"
        style="position:fixed; inset:0; z-index:999; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:400px; text-align:center; border: 1px solid rgba(255,255,255,0.1);">
            <div style="font-size: 3rem; color: var(--accent); margin-bottom: 10px;"><i class="ph ph-lock-key"></i>
            </div>
            <h1 style="margin-bottom: 10px;">YÃ¶netici GiriÅŸi</h1>
            <p style="color: var(--text-muted); margin-bottom: 30px;">Devam etmek iÃ§in kimliÄŸini doÄŸrula.</p>

            <input type="email" id="emailInput" class="form-control" placeholder="E-Posta" style="margin-bottom:15px;">
            <input type="password" id="passwordInput" class="form-control" placeholder="Åifre"
                style="margin-bottom:25px;">
            <button id="loginBtn" class="action-btn" style="width: 100%;">GiriÅŸ Yap <i
                    class="ph ph-arrow-right"></i></button>
        </div>
    </div>


    <div class="sidebar">
        <div class="brand">
            <i class="ph-fill ph-books"></i> Minemsiyle
        </div>

        <a href="index.html" target="_blank" class="menu-item"
            style="text-decoration: none; background: rgba(255,255,255,0.05); margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1);">
            <i class="ph-fill ph-house" style="color: #d4a373;"></i>
            <span style="color: white;">Siteyi GÃ¶rÃ¼ntÃ¼le</span>
            <i class="ph ph-arrow-square-out" style="margin-left: auto; font-size: 1rem; opacity: 0.5;"></i>
        </a>

        <div id="btn-dashboard" class="menu-item active">
            <i class="ph ph-squares-four"></i> Genel BakÄ±ÅŸ
        </div>

        <div id="btn-blog" class="menu-item">
            <i class="ph ph-pen-nib"></i> Blog YazÄ±sÄ±
        </div>

        <div id="btn-book" class="menu-item">
            <i class="ph ph-book-open-text"></i> Kitap Ekle
        </div>

        <div id="btn-widget" class="menu-item">
            <i class="ph ph-sliders"></i> Sidebar / Widget
        </div>

        <div id="btn-users" class="menu-item">
            <i class="ph ph-users"></i> KullanÄ±cÄ±lar
        </div>

        <div id="btn-settings" class="menu-item">
            <i class="ph ph-gear"></i> Ayarlar
        </div>

        <button onclick="logout()" class="logout-btn">
            <i class="ph ph-sign-out"></i> Ã‡Ä±kÄ±ÅŸ Yap
        </button>
    </div>

    <main class="main-content">

        <div id="page-dashboard" class="tab-content" style="display: block;">
            <header>
                <div>
                    <h1>HoÅŸ geldin, YÃ¶netici ğŸ‘‹</h1>
                    <div class="breadcrumb">Panel Ã–zeti ve Ä°statistikler</div>
                </div>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="ph-bold ph-users"></i></div>
                    <div>
                        <h3 id="statTotalUsers">...</h3>
                        <p>Toplam KullanÄ±cÄ±</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(16, 185, 129, 0.1); color:#10b981;">
                        <i class="ph-bold ph-article"></i>
                    </div>
                    <div>
                        <h3 id="statTotalBlogs">...</h3>
                        <p>YayÄ±ndaki Blog</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(245, 158, 11, 0.1); color:#f59e0b;">
                        <i class="ph-bold ph-books"></i>
                    </div>
                    <div>
                        <h3 id="statTotalBooks">...</h3>
                        <p>KÃ¼tÃ¼phane KitabÄ±</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-card" style="grid-column: span 2;">

                <div class="card-header">
                    <h3>ğŸš€ Son Hareketler</h3>
                    <button onclick="loadRecentActivities()" class="refresh-btn">
                        <i class="ph ph-arrows-clockwise"></i> Yenile
                    </button>
                </div>

                <div class="recent-activities-list">
                </div>
            </div>
        </div>
        </div>


        <div id="page-blog" class="tab-content" style="display: none;">
            <header>
                <div>
                    <h1>Blog YazÄ±sÄ± PaylaÅŸ</h1>
                    <div class="breadcrumb">Ä°Ã§erik YÃ¶netimi > Yeni YazÄ±</div>
                </div>
            </header>

            <div class="card">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">BaÅŸlÄ±k</label>
                        <input type="text" id="postTitle" class="form-control" placeholder="Ã–rn: Kahve ve Kitap">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <input type="text" id="postCategory" class="form-control" placeholder="Ã–rn: Deneme">
                    </div>
                    <div class="form-group form-grid full">
                        <label class="form-label">Kapak Resmi URL</label>
                        <input type="text" id="postImage" class="form-control"
                            placeholder="Resim Linkini YapÄ±ÅŸtÄ±r (https://...)">
                    </div>
                    <div class=" form-group form-grid full">
                        <label class="form-label">KÄ±sa Ã–zet</label>
                        <textarea id="postExcerpt" class="form-control" rows="2"
                            placeholder="Listeleme sayfasÄ±nda gÃ¶rÃ¼necek kÄ±sa yazÄ±..."></textarea>
                    </div>
                    <div class="form-group form-grid full">
                        <label class="form-label">Ä°Ã§erik</label>
                        <textarea id="postContent" class="form-control" style="min-height: 250px;"
                            placeholder="YazÄ±nÄ± buraya dÃ¶k..."></textarea>
                    </div>
                </div>
                <div style="margin-top: 25px; text-align: right;">
                    <button class="action-btn" id="savePostBtn"><i class="ph ph-paper-plane-right"></i> YayÄ±na
                        Al</button>
                </div>

                <div class="card" style="margin-top: 30px; background: rgba(0,0,0,0.2);">
                    <h3>YayÄ±ndaki Blog YazÄ±larÄ±</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>BaÅŸlÄ±k</th>
                                    <th>Ä°ÅŸlem</th>
                                </tr>
                            </thead>
                            <tbody id="postsListBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div id="page-book" class="tab-content" style="display: none;">
            <header>
                <div>
                    <h1>KÃ¼tÃ¼phaneye Kitap Ekle</h1>
                    <div class="breadcrumb">Ä°Ã§erik YÃ¶netimi > Yeni Kitap</div>
                </div>
            </header>

            <div class="card">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Kitap AdÄ±</label>
                        <input type="text" id="bookTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Yazar</label>
                        <input type="text" id="bookAuthor" class="form-control">
                    </div>
                    <div style="display: flex; gap: 15px; grid-column: span 2;">
                        <div class="form-group" style="flex:1;">
                            <label class="form-label">YayÄ±nevi</label>
                            <input type="text" id="bookPublisher" class="form-control" placeholder="Ã–rn: Can YayÄ±nlarÄ±">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label class="form-label">BasÄ±m YÄ±lÄ±</label>
                            <input type="number" id="bookYear" class="form-control" placeholder="2024">
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label class="form-label">Sayfa SayÄ±sÄ±</label>
                            <input type="number" id="bookPageCount" class="form-control" placeholder="320">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">TÃ¼r</label>
                        <select id="bookTag" class="form-control" style="background-color: var(--bg-input);">
                            <option>Roman</option>
                            <option>Tarih</option>
                            <option>KiÅŸisel GeliÅŸim</option>
                            <option>Åiir</option>
                            <option>Bilim Kurgu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kapak Resmi URL</label>
                        <input type="text" id="bookImage" class="form-control" placeholder="https://...">
                    </div>
                    <div class="form-group form-grid full">
                        <label class="form-label">AÃ§Ä±klama / Ä°nceleme</label>
                        <textarea id="bookContent" class="form-control" rows="4"></textarea>
                    </div>
                </div>
                <div style="margin-top: 25px; text-align: right;">
                    <button class="action-btn" id="saveBookBtn"><i class="ph ph-plus"></i> KÃ¼tÃ¼phaneye Ekle</button>
                </div>

                <div class="card" style="margin-top: 30px; background: rgba(0,0,0,0.2);">
                    <h3>KÃ¼tÃ¼phanedeki Kitaplar</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Kitap AdÄ±</th>
                                    <th>Yazar</th>
                                    <th>Ä°ÅŸlem</th>
                                </tr>
                            </thead>
                            <tbody id="booksListBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div id="page-widget" class="tab-content" style="display: none;">
            <header>
                <div>
                    <h1>Sidebar & Widget YÃ¶netimi</h1>
                    <div class="breadcrumb">GÃ¶rÃ¼nÃ¼m > Yan MenÃ¼</div>
                </div>
            </header>

            <div class="card" style="margin-bottom: 20px;">
                <h3>ğŸ’¬ GÃ¼nÃ¼n SÃ¶zleri Havuzu</h3>
                <p style="color:gray; font-size:0.9rem; margin-bottom:15px;">Buraya birden fazla sÃ¶z ekleyebilirsin.
                    Ana
                    sayfada her yenilemede rastgele biri Ã§Ä±kar.</p>

                <div
                    style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Yeni SÃ¶z</label>
                        <textarea id="newQuoteText" class="form-control" rows="2"
                            placeholder="SÃ¶zÃ¼ buraya yaz..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div class="form-group" style="flex:1; margin-bottom:0;">
                            <label class="form-label">SÃ¶yleyen (Yazar)</label>
                            <input type="text" id="newQuoteAuthor" class="form-control" placeholder="Ã–rn: Kafka">
                        </div>
                        <button class="action-btn" onclick="addQuote()">â• Listeye Ekle</button>
                    </div>
                </div>

                <h4 style="margin-bottom:10px;">ğŸ“‹ Ekli SÃ¶zler</h4>
                <div style="max-height: 250px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(255,255,255,0.05); color: var(--accent); text-align: left;">
                                <th style="padding: 10px;">SÃ¶z</th>
                                <th style="padding: 10px;">Yazar</th>
                                <th style="padding: 10px; width: 50px;">Sil</th>
                            </tr>
                        </thead>
                        <tbody id="quoteListBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="margin-top:20px;">
                <h3>ğŸ“– Åu An Masamda</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Kitap AdÄ±</label>
                        <input type="text" id="widgetBookTitle" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Yazar</label>
                        <input type="text" id="widgetBookAuthor" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kapak Resmi YÃ¼kle</label>
                        <input type="file" id="bookCoverInput" class="file-input-hidden" accept="image/*">
                        <label for="bookCoverInput" class="file-upload-label">
                            <i class="ph-bold ph-cloud-arrow-up"></i> <span>Bilgisayardan bir resim seÃ§...</span>
                        </label>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Toplam Sayfa</label>
                        <input type="number" id="widgetTotalPage" class="form-control" oninput="calcWidgetPercent()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Okunan Sayfa</label>
                        <input type="number" id="widgetCurrentPage" class="form-control" oninput="calcWidgetPercent()">
                    </div>
                </div>

                <div style="background:#333; height:10px; border-radius:5px; margin:10px 0; overflow:hidden;">
                    <div id="widgetProgressBar"
                        style="width:0%; height:100%; background:var(--accent); transition:0.3s;"></div>
                </div>
                <p id="widgetPercentText" style="text-align:right; font-size:12px; color:gray;">%0 TamamlandÄ±</p>

                <div style="display:flex; justify-content:space-between; margin-top:15px;">
                    <button class="action-btn" onclick="saveWidgets()">GÃ¼ncelle</button>
                    <button class="action-btn" style="background:var(--success);" onclick="finishBook()">ğŸ‰ KitabÄ±
                        Bitirdim!</button>
                </div>
            </div>

            <div class="card" style="margin-top:20px;">
                <h3>ğŸ¯ 2026 Hedefi</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">YÄ±llÄ±k Hedef (SayÄ±)</label>
                        <input type="number" id="widgetGoalTarget" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Åu Ana Kadar Biten</label>
                        <input type="number" id="widgetGoalCurrent" class="form-control">
                    </div>
                </div>
                <button class="action-btn" onclick="saveWidgets()">Hedefi GÃ¼ncelle</button>
            </div>
        </div>


        <div id="page-users" class="tab-content" style="display: none;">
            <header>
                <div>
                    <h1>KullanÄ±cÄ± YÃ¶netimi</h1>
                    <div class="breadcrumb">Topluluk > Ãœye Listesi</div>
                </div>
                <button class="action-btn" onclick="loadUsers()"
                    style="background: var(--bg-input); border: 1px solid var(--border-color); color: white;">
                    <i class="ph ph-arrows-clockwise"></i> Yenile
                </button>
            </header>

            <div class="card" style="padding: 0; overflow: hidden;">
                <div style="padding: 20px; border-bottom: 1px solid var(--border-color);">
                    <input type="text" id="userSearchInput" onkeyup="searchUsers()" class="form-control"
                        placeholder="ğŸ” KullanÄ±cÄ± adÄ± veya e-posta ara..." onkeyup="filterUsers()"
                        style="max-width: 400px;">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>KullanÄ±cÄ±</th>
                                <th>Email</th>
                                <th>Rozetler</th>
                                <th>Durum</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>


        <div id="page-settings" class="tab-content" style="display: none;">
            <header>
                <div>
                    <h1>Site AyarlarÄ±</h1>
                    <div class="breadcrumb">Sistem > KonfigÃ¼rasyon</div>
                </div>
            </header>

            <div class="card">
                <div
                    style="display: flex; align-items: center; justify-content: space-between; padding: 20px; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px;">
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div style="font-size: 2rem; color: var(--danger);"><i class="ph ph-warning-octagon"></i>
                        </div>
                        <div>
                            <h3 style="color: var(--text-main); font-size: 1.1rem; margin-bottom: 5px;">BakÄ±m Modu
                            </h3>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">Siteyi ziyaretÃ§ilere kapatÄ±r,
                                sadece
                                "TadilattayÄ±z" sayfasÄ± gÃ¶rÃ¼nÃ¼r.</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="maintenanceToggle">
                        <span class="slider"></span>
                    </label>
                </div>

                <div style="margin-top: 30px; text-align: right;">
                    <button class="action-btn" onclick="saveSystemSettings()"><i class="ph ph-floppy-disk"></i>
                        AyarlarÄ±
                        Kaydet</button>
                </div>
            </div>
        </div>
    </main>
    <div id="badgeModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px;">ğŸ–ï¸ Rozetleri DÃ¼zenle</h3>
            <p style="color:gray; font-size:0.9rem; margin-bottom:20px;">KullanÄ±cÄ±ya vermek istediÄŸin rozetleri seÃ§:
            </p>

            <div id="badgeOptionsList">
            </div>

            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button class="action-btn" style="background:#333;" onclick="closeBadgeModal()">Ä°ptal</button>
                <button class="action-btn" onclick="saveBadges()">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "/api";

        // --- RESMÄ° KODA Ã‡EVÄ°REN FONKSÄ°YON (Bunu en Ã¼ste ekle) ---
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // ğŸ•’ Tarih ve Saat FormatlayÄ±cÄ±
        function formatFullDate(dateString) {
            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('tr-TR', options).replace(' ', ' - ');
        }

        // TOAST BILDIRIM FONKSIYONU ğŸ
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = type === 'success' ? 'var(--success)' : 'var(--danger)';

            let icon = type === 'success' ? '<i class="ph ph-check-circle" style="font-size:1.5rem; color:var(--success)"></i>' : '<i class="ph ph-warning-circle" style="font-size:1.5rem; color:var(--danger)"></i>';

            toast.innerHTML = `${icon} <span>${message}</span>`;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s reverse forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // GÄ°RÄ°Å KONTROLLERÄ°
        window.onload = () => {
            const token = localStorage.getItem('userToken');
            const role = localStorage.getItem('userRole');
            if (token && role === 'admin') {
                document.getElementById('login-screen').style.display = 'none';
                // Dashboard aÃ§Ä±lÄ±nca kullanÄ±cÄ± sayÄ±sÄ±nÄ± gÃ¼ncelle
                loadUsersForStat();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        };

        // GÄ°RÄ°Å YAP BUTONU
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (res.ok && (data.user?.role === 'admin' || data.role === 'admin')) {
                    localStorage.setItem('userToken', data.token);
                    localStorage.setItem('userRole', 'admin');
                    showToast("GiriÅŸ BaÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...");
                    setTimeout(() => location.reload(), 1000);
                } else { showToast("Yetkisiz giriÅŸ veya hatalÄ± ÅŸifre!", "error"); }
            } catch (err) { showToast("Sunucu hatasÄ± oluÅŸtu.", "error"); }
        });

        // SEKME GEÃ‡Ä°ÅLERÄ°
        window.switchTab = (id, btn) => {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
            if (id === 'users-section') loadUsers();
        };

        // --- BLOG YAYINLA BUTONU (TAM MANUEL KONTROL ğŸ› ï¸) ---
        document.getElementById('savePostBtn').addEventListener('click', async () => {
            console.log("ğŸš€ YayÄ±nlama iÅŸlemi baÅŸladÄ±...");

            // 1. KUTULARI AL
            // (Buradaki ID'lerin senin HTML'deki ID'lerle AYNI olduÄŸundan emin ol)
            const titleVal = document.getElementById('postTitle').value;
            const categoryVal = document.getElementById('postCategory').value;
            const contentVal = document.getElementById('postContent').value; // Ä°Ã§erik
            const excerptVal = document.getElementById('postExcerpt').value; // Ã–zet
            const imageVal = document.getElementById('postImage').value;     // Resim URL

            // 2. KONTROL ET (Konsola yazdÄ±rÄ±yoruz ki boÅŸ mu gidiyor gÃ¶relim)
            console.log("ğŸ“ BaÅŸlÄ±k:", titleVal);
            console.log("ğŸ“ Ä°Ã§erik (Uzunluk):", contentVal.length);
            console.log("ğŸ“ Ã–zet:", excerptVal);
            console.log("ğŸ“¸ Resim:", imageVal);

            // 3. PAKETLE (Hem 'image' hem 'cover' olarak gÃ¶nderiyoruz, iÅŸi saÄŸlama alÄ±yoruz)
            const postData = {
                title: titleVal,
                category: categoryVal || "Genel",
                content: contentVal,  // YazÄ±nÄ±n kendisi (Burada veri olduÄŸundan emin ol)
                excerpt: excerptVal,  // Sen ne yazdÄ±ysan o. (Otomatik kÄ±saltma YOK)
                image: imageVal,
                cover: imageVal,      // Backend bazen bunu istiyor
                author: JSON.parse(localStorage.getItem('user'))?.name || "Anonim",
                date: new Date()
            };

            // 4. GÃ–NDER
            try {
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });

                if (response.ok) {
                    alert("âœ… YazÄ± olduÄŸu gibi kaydedildi!");
                    // Yeni yazÄ± denemen iÃ§in sayfayÄ± yeniliyorum
                    location.reload();
                } else {
                    const err = await response.json();
                    alert("Hata: " + err.error);
                }
            } catch (error) {
                alert("Sunucuya ulaÅŸÄ±lamadÄ± (Server kapalÄ± olabilir).");
            }
        });

        // ===============================================
        // ğŸ“š KÄ°TAP YAYINLA BUTONU (SENÄ°N MODELÄ°NE UYUMLU âœ…)
        // ===============================================
        const saveBookBtn = document.getElementById('saveBookBtn');

        if (saveBookBtn) {
            saveBookBtn.addEventListener('click', async () => {
                console.log("ğŸ“š Kitap iÅŸlemeye baÅŸlandÄ±...");

                // 1. KUTULARI SEÃ‡
                const titleEl = document.getElementById('bookTitle');
                const authorEl = document.getElementById('bookAuthor');
                const imageEl = document.getElementById('bookImage');
                const contentEl = document.getElementById('bookContent'); // Ä°nceleme yazÄ±sÄ±
                const publisherEl = document.getElementById('bookPublisher');
                const pageCountEl = document.getElementById('bookPageCount');
                // Kategori/Tag kutusu varsa al, yoksa 'Roman' yap
                const tagEl = document.getElementById('bookCategory') || document.getElementById('bookTag');

                // 2. DEÄERLERÄ° AL
                const title = titleEl ? titleEl.value.trim() : "";
                const author = authorEl ? authorEl.value.trim() : "";
                const content = contentEl ? contentEl.value.trim() : "";
                const imageURL = imageEl ? imageEl.value.trim() : "";

                // BoÅŸsa varsayÄ±lan deÄŸerler
                const publisher = publisherEl ? publisherEl.value.trim() : "Bilinmiyor";
                const pageCount = pageCountEl ? parseInt(pageCountEl.value) : 0;
                const tag = tagEl ? tagEl.value : "Roman";
                const cover = imageURL !== "" ? imageURL : "https://via.placeholder.com/300x450?text=Kitap";

                // 3. PAKETLE (SENÄ°N SCHEMA'NA GÃ–RE ğŸ¯)
                const bookData = {
                    title: title,
                    author: author,
                    publisher: publisher,
                    pageCount: pageCount,

                    // ğŸ‘‡ KRÄ°TÄ°K NOKTA: Senin modelinde 'desc' yazÄ±yor, 'review' deÄŸil!
                    desc: content,

                    // ğŸ‘‡ Senin modelinde 'cover' yazÄ±yor, 'image' deÄŸil!
                    cover: cover,

                    tag: tag,
                    year: new Date().getFullYear(), // Otomatik bu yÄ±lÄ± ekle
                    addedBy: JSON.parse(localStorage.getItem('user'))?.name || "Admin"
                };

                console.log("ğŸ“¤ GÃ¶nderilen Kitap Verisi:", bookData);

                // 4. GÃ–NDER
                try {
                    const response = await fetch('/api/books', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(bookData)
                    });

                    if (response.ok) {
                        alert("âœ… Kitap eksiksiz eklendi!");
                        location.reload();
                    } else {
                        const err = await response.json();
                        alert("Hata: " + (err.error || "Sunucu kabul etmedi."));
                    }
                } catch (error) {
                    console.error(error);
                    alert("Sunucu kapalÄ± olabilir.");
                }
            });
        }

        // --- DEÄÄ°ÅKENLER ---
        let selectedUserId = null; // Hangi kullanÄ±cÄ±yÄ± dÃ¼zenliyoruz?
        const AVAILABLE_BADGES = [
            // --- YETKÄ° & STATÃœ ---
            { id: 'admin', label: 'YÃ¶netici', icon: 'ph-shield-check', class: 'badge-admin-role' },
            { id: 'mod', label: 'ModeratÃ¶r', icon: 'ph-shield', class: 'badge-mod' },
            { id: 'dev', label: 'GeliÅŸtirici', icon: 'ph-code', class: 'badge-dev' },

            // --- ÃœYELÄ°K & DESTEK ---
            { id: 'vip', label: 'VIP Ãœye', icon: 'ph-sparkle', class: 'badge-vip' },
            { id: 'supporter', label: 'DestekÃ§i', icon: 'ph-heart', class: 'badge-supporter' },
            { id: 'verified', label: 'OnaylÄ±', icon: 'ph-check-circle', class: 'badge-verified' },

            // --- Ä°Ã‡ERÄ°K ÃœRETÄ°CÄ° ---
            { id: 'writer', label: 'Yazar', icon: 'ph-pen-nib', class: 'badge-writer' },
            { id: 'poet', label: 'Åair', icon: 'ph-feather', class: 'badge-poet' },

            // --- EÄLENCELÄ° & AKTÄ°VÄ°TE ---
            { id: 'bug_hunter', label: 'Bug AvcÄ±sÄ±', icon: 'ph-bug', class: 'badge-bug' },
            { id: 'bookworm', label: 'Kitap Kurdu', icon: 'ph-book-open', class: 'badge-bookworm' },
            { id: 'coffee', label: 'Kahve Sever', icon: 'ph-coffee', class: 'badge-coffee' },
            { id: 'cat_lover', label: 'Kedi Sever', icon: 'ph-cat', class: 'badge-cat' }
        ];



        // --- MODAL Ä°ÅLEMLERÄ° ---

        // Global deÄŸiÅŸkenler
        let selectedUserEmail = null;

        // 2. ModalÄ± AÃ§ (AKILLI VERSÄ°YON)
        function openBadgeModal(userId) {
            // 1. Global listeden kullanÄ±cÄ±yÄ± bul
            const user = window.allUsersData.find(u => (u._id === userId || u.id === userId));

            if (!user) {
                alert("Hata: KullanÄ±cÄ± verisi bulunamadÄ±!");
                return;
            }

            // 2. Bilgileri HafÄ±zaya Al
            selectedUserId = userId;
            selectedUserEmail = user.email; // ğŸ”¥ E-postayÄ± buradan alÄ±yoruz
            const currentBadges = user.badges || []; // Mevcut rozetleri al

            console.log("SeÃ§ilen KullanÄ±cÄ±:", user.username, selectedUserEmail);

            // 3. Listeyi Temizle ve Doldur
            const list = document.getElementById('badgeOptionsList');
            list.innerHTML = '';

            // AVAILABLE_BADGES listesini kullanarak seÃ§enekleri oluÅŸtur
            AVAILABLE_BADGES.forEach(badge => {
                const isSelected = currentBadges.includes(badge.id); // Rozet var mÄ±?

                const item = document.createElement('div');
                item.className = `badge-option ${isSelected ? 'selected' : ''}`;
                item.onclick = function () { this.classList.toggle('selected'); };
                item.dataset.id = badge.id;

                item.innerHTML = `
            <div style="display:flex; align-items:center; gap:10px;">
                <span class="custom-badge ${badge.class}">
                    <i class="ph-bold ${badge.icon}"></i> ${badge.label}
                </span>
            </div>
            ${isSelected ? '<i class="ph-fill ph-check-circle" style="color:var(--accent)"></i>' : '<i class="ph ph-circle"></i>'}
        `;
                list.appendChild(item);
            });

            // 4. ModalÄ± GÃ¶ster (Sadece burada olmalÄ±!)
            document.getElementById('badgeModal').classList.add('open');

        }

        // 2. ModalÄ± Kapat
        function closeBadgeModal() {
            document.getElementById('badgeModal').classList.remove('open');
            selectedUserId = null;
        }

        // 3. Rozetleri Kaydet (EMAÄ°L Ä°LE EÅLEÅTÄ°RME - KESÄ°N Ã‡Ã–ZÃœM)
        async function saveBadges() {
            // ID veya Email yoksa dur
            if (!selectedUserId && !selectedUserEmail) return;

            // SeÃ§ili rozetleri al
            const selectedElements = document.querySelectorAll('.badge-option.selected');
            const newBadges = Array.from(selectedElements).map(el => el.dataset.id);

            console.log(`Kaydediliyor... Email: ${selectedUserEmail}, Rozetler:`, newBadges);

            // --- A) LOCALSTORAGE GÃœNCELLEME (GARANTÄ° YÃ–NTEM) ---
            try {
                let localUsers = JSON.parse(localStorage.getItem('users') || "[]");

                // ğŸ”¥ KRÄ°TÄ°K HAMLE: ID yerine EMAIL ile buluyoruz!
                let userIndex = localUsers.findIndex(u => u.email === selectedUserEmail);

                if (userIndex > -1) {
                    // Hem 'badges' hem 'tags' olarak kaydet (Ä°ÅŸimiz garanti olsun)
                    localUsers[userIndex].badges = newBadges;
                    localUsers[userIndex].tags = newBadges;

                    localStorage.setItem('users', JSON.stringify(localUsers));
                    console.log("âœ… LocalStorage gÃ¼ncellendi!");

                    // EÄŸer kendi profilini dÃ¼zenliyorsan, oturumu da gÃ¼ncelle
                    let currentUser = JSON.parse(localStorage.getItem('user'));
                    if (currentUser && currentUser.email === selectedUserEmail) {
                        currentUser.badges = newBadges;
                        currentUser.tags = newBadges;
                        localStorage.setItem('user', JSON.stringify(currentUser));
                        console.log("âœ… Mevcut oturum gÃ¼ncellendi!");
                    }
                } else {
                    console.warn("âš ï¸ KullanÄ±cÄ± LocalStorage'da bulunamadÄ± (Email eÅŸleÅŸmedi).");
                }
            } catch (err) {
                console.error("LocalStorage hatasÄ±:", err);
            }

            // --- B) API GÃœNCELLEME (SUNUCU VARSA) ---
            try {
                const token = localStorage.getItem('userToken');
                // Backend'e yine ID ile gÃ¶nderiyoruz (OrasÄ± ID sever)
                await fetch(`${API_URL}/users/${selectedUserId}/badges`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify({ badges: newBadges })
                });
            } catch (err) {
                console.log("API isteÄŸi pas geÃ§ildi veya baÅŸarÄ±sÄ±z.");
            }

            showToast("Rozetler baÅŸarÄ±yla gÃ¼ncellendi! ğŸ–ï¸");
            closeBadgeModal();
            loadloadUsers(); // Listeyi yenile
        }


        // Global deÄŸiÅŸken (KullanÄ±cÄ±larÄ± burada tutacaÄŸÄ±z)
        window.allUsersData = [];

        // --- KULLANICILARI LÄ°STELEME (TÃ¼rkÃ§e & Renkli Versiyon) ---
        async function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;

            try {
                const res = await fetch(`${API_URL}/users`);
                const users = await res.json();

                // Verileri global deÄŸiÅŸkene yedekle
                window.allUsersData = users;

                tbody.innerHTML = '';
                const countBadge = document.getElementById('statTotalUsers');
                if (countBadge) countBadge.innerText = users.length;

                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">KullanÄ±cÄ± yok.</td></tr>';
                    return;
                }

                users.forEach(user => {
                    const tr = document.createElement('tr');

                    // --- DURUM KISMI (SEBEP EKLENDÄ°) ---
                    let statusHTML = '';

                    if (user.isBanned) {
                        // Ban sebebini al, yoksa varsayÄ±lan yaz
                        const reason = user.banReason || 'Sebep belirtilmedi';

                        statusHTML = `
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <span style="color:var(--danger); font-weight:bold; font-size:0.9rem;">
                            <i class="ph-fill ph-warning-circle"></i> BanlÄ±
                        </span>
                        <span style="font-size:0.75rem; color:#aaa; margin-top:2px; font-style:italic;">
                            "${reason}"
                        </span>
                    </div>
                `;
                        // SatÄ±rÄ± biraz soluk yapalÄ±m ki banlÄ± olduÄŸu belli olsun
                        tr.style.opacity = "0.7";

                    } else {
                        statusHTML = `<span style="color:#10b981; font-weight:bold;">â— Aktif</span>`;
                        tr.style.opacity = "1";
                    }

                    // --- ROZETLERÄ° TÃœRKÃ‡ELEÅTÄ°RME KISMI ---
                    let badgesHTML = '<div class="badge-container" style="display:flex; gap:5px; flex-wrap:wrap;">';

                    if (user.badges && user.badges.length > 0) {
                        user.badges.forEach(badgeId => {
                            // 1. Bu ID'nin (Ã¶rn: 'bug_hunter') TÃ¼rkÃ§e karÅŸÄ±lÄ±ÄŸÄ±nÄ± listeden bul
                            const badgeInfo = AVAILABLE_BADGES.find(b => b.id === badgeId);

                            if (badgeInfo) {
                                // Bulduysak TÃ¼rkÃ§e adÄ±nÄ± ve kendi rengini kullan
                                badgesHTML += `
                            <span class="custom-badge ${badgeInfo.class}">
                                <i class="ph-bold ${badgeInfo.icon}"></i> ${badgeInfo.label}
                            </span>`;
                            } else {
                                // Listede yoksa olduÄŸu gibi yaz (Yedek)
                                badgesHTML += `<span class="custom-badge badge-vip">${badgeId}</span>`;
                            }
                        });
                    } else {
                        badgesHTML += '<span style="color:gray; font-size:0.8rem;">-</span>';
                    }
                    badgesHTML += '</div>';

                    // Durum HTML


                    const userId = user._id || user.id;

                    tr.innerHTML = `
                <td><b>${user.username}</b></td>
                <td>${user.email}</td>
                <td>${badgesHTML}</td>
                <td>${statusHTML}</td>
                <td style="text-align:right;">
                    <div style="display:flex; justify-content:flex-end; gap:8px;">
                        <button class="action-btn" style="background:#6366f1; padding:6px 12px;" 
                            onclick="openBadgeModal('${userId}')">
                            <i class="ph-bold ph-medal"></i>
                        </button>
                        <button class="action-btn" style="background:${user.isBanned ? '#3b82f6' : 'var(--danger)'}; padding:6px 12px;" 
                            onclick="banUser('${userId}', ${user.isBanned})">
                            <i class="ph-bold ${user.isBanned ? 'ph-arrow-u-up-left' : 'ph-prohibit'}"></i>
                        </button>
                    </div>
                </td>
            `;
                    tbody.appendChild(tr);
                });
            } catch (error) { console.error(error); }
        }

        // ğŸš« BANLAMA Ä°ÅLEMÄ° 
        async function banUser(id, isCurrentlyBanned) {
            let reason = "";

            // EÄŸer ÅŸu an banlÄ± DEÄÄ°LSE, ban sebebini sor
            if (!isCurrentlyBanned) {
                reason = prompt("ğŸš« Bu kullanÄ±cÄ±yÄ± neden banlÄ±yorsun? Sebebi yaz:");
                if (reason === null) return; // Ä°ptal'e bastÄ±ysa iÅŸlem yapma
                if (reason.trim() === "") reason = "YÃ¶netici tarafÄ±ndan uzaklaÅŸtÄ±rÄ±ldÄ±."; // BoÅŸ bÄ±raktÄ±ysa
            } else {
                if (!confirm("KullanÄ±cÄ±nÄ±n banÄ±nÄ± kaldÄ±rmak istiyor musun?")) return;
            }

            try {
                const res = await fetch(`${API_URL}/users/${id}/ban`, {
                    method: "PUT", // ArtÄ±k DELETE deÄŸil PUT kullanÄ±yoruz
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ reason: reason })
                });

                if (res.ok) {
                    loadUsers(); // Listeyi yenile
                } else {
                    alert("Ä°ÅŸlem baÅŸarÄ±sÄ±z!");
                }
            } catch (e) { console.error(e); }
        }

        // ğŸ–ï¸ ROZET (ROL) DEÄÄ°ÅTÄ°RME FONKSÄ°YONU
        async function toggleUserRole(id, role, status) {
            // role: 'isAdmin' veya 'isPremium'
            // status: true veya false (Yap veya Geri Al)
            try {
                const res = await fetch(`${API_URL}/users/${id}/role`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ role: role, status: status })
                });

                if (res.ok) {
                    loadUsers(); // Listeyi yenile ki rengi deÄŸiÅŸsin
                } else {
                    alert("Yetki deÄŸiÅŸmedi!");
                }
            } catch (e) { console.error(e); }
        }

        // SADECE ISTATISTIK YUKLE (Dashboard iÃ§in)
        async function loadUsersForStat() {
            const token = localStorage.getItem('userToken');
            try {
                const res = await fetch(`${API_URL}/admin/users`, { headers: { 'Authorization': `Bearer ${token}` } });
                const data = await res.json();
                if (data.users) document.getElementById('statUsers').innerText = data.users.length;
            } catch (e) { }
        }

        // ARAMA
        window.filterUsers = () => {
            const input = document.getElementById('userSearch');
            const filter = input.value.toLowerCase();
            const rows = document.querySelectorAll('.user-row');
            rows.forEach(row => {
                const name = row.querySelector('.user-name').textContent.toLowerCase();
                const email = row.querySelector('.user-email').textContent.toLowerCase();
                row.style.display = (name.includes(filter) || email.includes(filter)) ? "" : "none";
            });
        };

        // BAN AÃ‡/KAPA
        window.toggleBan = async (id, isCurrentlyBanned) => {
            const token = localStorage.getItem('userToken');
            const endpoint = isCurrentlyBanned ? 'unban' : 'ban';
            let reason = null;

            if (!isCurrentlyBanned) {
                reason = prompt("KullanÄ±cÄ± neden yasaklanÄ±yor?", "Kural ihlali");
                if (!reason) return;
            } else {
                if (!confirm("YasaÄŸÄ± kaldÄ±rmak istediÄŸine emin misin?")) return;
            }

            await fetch(`${API_URL}/admin/${endpoint}/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ reason })
            });
            showToast(isCurrentlyBanned ? "KullanÄ±cÄ± yasaÄŸÄ± kaldÄ±rÄ±ldÄ±." : "KullanÄ±cÄ± yasaklandÄ±.");
            loadUsers();
        };

        // ROZET VER
        window.giveBadge = async (id) => {
            const badge = prompt("Verilecek rozet adÄ±? (Ã–rn: VIP, Yazar)");
            const token = localStorage.getItem('userToken');
            if (!badge) return;

            await fetch(`${API_URL}/admin/badge/${id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ badge })
            });
            showToast("Rozet baÅŸarÄ±yla tanÄ±mlandÄ±! ğŸ–ï¸");
            loadUsers();
        };

        // ROZET SÄ°L
        window.removeBadge = async (id, badgeName) => {
            if (!confirm(`${badgeName} rozetini silmek istiyor musun?`)) return;
            const token = localStorage.getItem('userToken');
            try {
                const res = await fetch(`${API_URL}/admin/remove-badge/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ badge: badgeName })
                });
                if (res.ok) {
                    showToast("Rozet silindi.");
                    loadUsers();
                }
            } catch (e) { showToast("Hata oluÅŸtu.", "error"); }
        };

        window.logout = () => { localStorage.clear(); location.reload(); }
        // ==========================================
        // ğŸ”¥ SÄ°LME VE LÄ°STELEME FONKSÄ°YONLARI ğŸ”¥
        // ==========================================

        // 1. KÄ°TAPLARI GETÄ°R VE LÄ°STELE
        async function loadAdminBooks() {
            const tbody = document.getElementById('booksListBody');
            if (!tbody) return;
            tbody.innerHTML = "<tr><td colspan='3'>YÃ¼kleniyor...</td></tr>";

            try {
                const res = await fetch(`${API_URL}/books`); // Standart kitap listesi rotasÄ±
                const books = await res.json();

                tbody.innerHTML = books.map(b => `
            <tr>
                <td>${b.title}</td>
                <td>${b.author}</td>
                <td>
                    <button class="action-btn" style="background:var(--danger); padding:5px 10px; font-size:12px;" onclick="deleteContent('books', '${b._id}')">
                        Sil ğŸ—‘ï¸
                    </button>
                </td>
            </tr>
        `).join('');
            } catch (e) { tbody.innerHTML = "<tr><td colspan='3'>Hata oluÅŸtu.</td></tr>"; }
        }

        // 2. BLOGLARI GETÄ°R VE LÄ°STELE
        async function loadAdminPosts() {
            const tbody = document.getElementById('postsListBody');
            if (!tbody) return;
            tbody.innerHTML = "<tr><td colspan='2'>YÃ¼kleniyor...</td></tr>";

            try {
                const res = await fetch(`${API_URL}/posts`);
                const posts = await res.json();

                tbody.innerHTML = posts.map(p => `
            <tr>
                <td>${p.title}</td>
                <td>
                    <button class="action-btn" style="background:var(--danger); padding:5px 10px; font-size:12px;" onclick="deleteContent('posts', '${p._id}')">
                        Sil ğŸ—‘ï¸
                    </button>
                </td>
            </tr>
        `).join('');
            } catch (e) { tbody.innerHTML = "<tr><td colspan='2'>Hata oluÅŸtu.</td></tr>"; }
        }

        // 3. GENEL SÄ°LME FONKSÄ°YONU
        // --- SÄ°LME Ä°ÅLEMLERÄ° (BAÄLANTILAR) ---

        // HTML'deki buton buna tÄ±klÄ±yor: onclick="deletePost('...')"
        window.deletePost = function (id) {
            icerigiSil('posts', id);
        };

        // EÄŸer kitap silme butonu ayrÄ±ysa: onclick="deleteBook('...')"
        window.deleteBook = function (id) {
            icerigiSil('books', id);
        };


        // --- ASIL SÄ°LME MOTORU ---
        async function icerigiSil(tur, id) {
            // 1. Son bir ÅŸans ver
            if (!confirm("âš ï¸ Bu iÃ§eriÄŸi silmek istediÄŸine emin misin?")) return;

            try {
                console.log(`Siliniyor... ID: ${id}`);


                const API_URL = "/api";

                // 2. Ä°steÄŸi gÃ¶nder (DELETE)
                const response = await fetch(`${API_URL}/${tur}/${id}`, {
                    method: "DELETE"
                });

                // 3. Sonuca bak
                if (response.ok) {
                    alert("âœ… GÃ¼le gÃ¼le! Ä°Ã§erik silindi.");
                    window.location.reload(); // SayfayÄ± yenile ki gideni gÃ¶rmeyelim
                } else {
                    alert("âŒ Silinemedi! Bir hata oldu.");
                }
            } catch (err) {
                console.error(err);
                alert("ğŸ’¥ Sunucuya ulaÅŸÄ±lamadÄ±! (Backend aÃ§Ä±k mÄ±?)");
            }
        }

        // 4. SAYFA AÃ‡ILINCA LÄ°STELERÄ° DOLDUR
        // switchTab fonksiyonunun iÃ§ine ekleme yapÄ±yoruz ki sekmeye basÄ±nca liste yenilensin
        const originalSwitchTab = window.switchTab;
        window.switchTab = (id, btn) => {
            originalSwitchTab(id, btn); // Eski iÅŸini yapsÄ±n
            if (id === 'add-book') loadAdminBooks(); // Kitap sekmesiyse kitaplarÄ± yÃ¼kle
            if (id === 'add-post') loadAdminPosts(); // Blog sekmesiyse bloglarÄ± yÃ¼kle
        };

        // Global deÄŸiÅŸken: TÃ¼m ayarlarÄ± burada tutacaÄŸÄ±z
        let CURRENT_SETTINGS = {};

        // Sayfa YÃ¼klenince
        document.addEventListener('DOMContentLoaded', loadWidgets);

        async function loadWidgets() {
            try {
                const res = await fetch(`${API_URL}/settings`);
                const data = await res.json();
                CURRENT_SETTINGS = data;

                // 1. LÄ°STE VARSA DOLDUR
                if (typeof renderQuoteList === "function") renderQuoteList();

                // 2. KÄ°TAP BÄ°LGÄ°LERÄ° (GÃ¼venli Kontrol: Ã–nce kutu var mÄ± diye bakÄ±yoruz)
                if (data.currentBook) {
                    const titleBox = document.getElementById('widgetBookTitle');
                    if (titleBox) titleBox.value = data.currentBook.title;

                    const authorBox = document.getElementById('widgetBookAuthor');
                    if (authorBox) authorBox.value = data.currentBook.author;

                    const totalPageBox = document.getElementById('widgetTotalPage');
                    if (totalPageBox) totalPageBox.value = data.currentBook.totalPage;

                    const currPageBox = document.getElementById('widgetCurrentPage');
                    if (currPageBox) currPageBox.value = data.currentBook.currentPage;
                }

                // 3. HEDEF
                if (data.goal) {
                    const goalTarget = document.getElementById('widgetGoalTarget');
                    if (goalTarget) goalTarget.value = data.goal.target;

                    const goalCurrent = document.getElementById('widgetGoalCurrent');
                    if (goalCurrent) goalCurrent.value = data.goal.current;
                }

            } catch (error) {
                console.error("YÃ¼kleme hatasÄ± (Ã–nemsiz olabilir):", error);
            }
        }

        // LÄ°STEYÄ° EKRANA BASAN FONKSÄ°YON
        function renderQuoteList() {
            const tbody = document.getElementById('quoteListBody');
            tbody.innerHTML = "";

            // EÄŸer quotes undefined ise boÅŸ dizi yap
            const quotes = CURRENT_SETTINGS.quotes || [];

            quotes.forEach((q, index) => {
                tbody.innerHTML += `
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                <td style="padding: 10px; font-size: 0.9rem;">"${q.text}"</td>
                <td style="padding: 10px; color: gray; font-size: 0.85rem;">${q.author}</td>
                <td style="padding: 10px;">
                    <button onclick="deleteQuote(${index})" style="background:none; border:none; cursor:pointer; color:var(--danger); font-size:1.2rem;">
                        <i class="ph-bold ph-trash"></i>
                    </button>
                </td>
            </tr>
        `;
            });
        }

        // YENÄ° SÃ–Z EKLE
        async function addQuote() {
            const text = document.getElementById('newQuoteText').value;
            const author = document.getElementById('newQuoteAuthor').value;

            if (!text) return alert("SÃ¶z kÄ±smÄ±nÄ± boÅŸ bÄ±rakma!");

            // Listeye ekle
            if (!CURRENT_SETTINGS.quotes) CURRENT_SETTINGS.quotes = [];
            CURRENT_SETTINGS.quotes.push({ text, author: author || "Anonim" });

            // VeritabanÄ±na Kaydet
            await saveOnlySettings();

            // InputlarÄ± temizle ve listeyi yenile
            document.getElementById('newQuoteText').value = "";
            document.getElementById('newQuoteAuthor').value = "";
            renderQuoteList();
        }

        // SÃ–Z SÄ°L
        async function deleteQuote(index) {
            if (!confirm("Bu sÃ¶zÃ¼ silmek istiyor musun?")) return;

            // Listeden Ã§Ä±kar
            CURRENT_SETTINGS.quotes.splice(index, 1);

            // VeritabanÄ±na Kaydet
            await saveOnlySettings();
            renderQuoteList();
        }

        // SADECE AYARLARI KAYDET (YardÄ±mcÄ± Fonksiyon)
        async function saveOnlySettings() {
            const token = localStorage.getItem('userToken');
            await fetch(`${API_URL}/settings`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify(CURRENT_SETTINGS)
            });
        }

        // YÃœZDE HESAPLAMA (Otomatik)
        function calcPercent() {
            const total = document.getElementById('widgetTotalPage').value || 1;
            const current = document.getElementById('widgetCurrentPage').value || 0;

            // YÃ¼zdeyi hesapla
            let percent = Math.round((current / total) * 100);
            if (percent > 100) percent = 100; // 100'Ã¼ geÃ§mesin

            // Ã‡ubuÄŸu ve yazÄ±yÄ± gÃ¼ncelle
            const bar = document.getElementById('widgetProgressBar');
            const text = document.getElementById('widgetPercentText');

            if (bar && text) {
                bar.style.width = `${percent}%`;
                text.innerText = `%${percent} TamamlandÄ±`;
            }
        }


        // ==========================================
        // ğŸ’¾ GÃœNCELLEME BUTONU (Resim Ã‡evirme Ã–zellikli)
        // ==========================================
        async function saveWidgets() {
            // 1. Ã–nce YazÄ± Olan Verileri AlalÄ±m
            CURRENT_SETTINGS.currentBook.title = document.getElementById('widgetBookTitle').value;
            CURRENT_SETTINGS.currentBook.author = document.getElementById('widgetBookAuthor').value;
            CURRENT_SETTINGS.currentBook.totalPage = document.getElementById('widgetTotalPage').value;
            CURRENT_SETTINGS.currentBook.currentPage = document.getElementById('widgetCurrentPage').value;

            CURRENT_SETTINGS.goal.target = document.getElementById('widgetGoalTarget').value;
            CURRENT_SETTINGS.goal.current = document.getElementById('widgetGoalCurrent').value;

            // 2. Åimdi Resim KÄ±smÄ±na BakalÄ±m
            const fileInput = document.getElementById('bookCoverInput');

            // EÄER YENÄ° BÄ°R RESÄ°M SEÃ‡Ä°LDÄ°YSE
            if (fileInput && fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                const reader = new FileReader();

                // Dosya okuma iÅŸlemi bitince Ã§alÄ±ÅŸacak kod:
                reader.onload = async function (e) {
                    // Resmi Base64 formatÄ±na (uzun yazÄ±ya) Ã§evirip ayara ekle
                    CURRENT_SETTINGS.currentBook.cover = e.target.result;

                    // VeritabanÄ±na Kaydet
                    await saveOnlySettings();
                    alert("Resim ve Bilgiler GÃ¼ncellendi! âœ…");
                };

                // OkumayÄ± baÅŸlat
                reader.readAsDataURL(file);
            }
            // EÄER RESÄ°M SEÃ‡Ä°LMEDÄ°YSE (Sadece yazÄ±larÄ± gÃ¼ncelle)
            else {
                // Eski resim kalsÄ±n, sadece diÄŸerlerini kaydet
                await saveOnlySettings();
                alert("Bilgiler GÃ¼ncellendi! (Resim deÄŸiÅŸmedi) âœ…");
            }
        }



        // KÄ°TABI BÄ°TÄ°R BUTONU
        async function finishBook() {
            if (!confirm("Tebrikler! ğŸ¥³ Bu kitabÄ± bitirip sayaca eklemek istiyor musun?")) return;

            const token = localStorage.getItem('userToken');
            await fetch(`${API_URL}/settings/finish-book`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });

            alert("HarikasÄ±n! SayaÃ§ gÃ¼ncellendi. ğŸ“š");
            loadWidgets(); // SayfayÄ± yenile
        }
        // ==========================================
        // âš™ï¸ SÄ°STEM AYARLARI (Senin KÄ±rmÄ±zÄ± Kutulu Sayfa Ä°Ã§in)
        // ==========================================

        // Sayfa yÃ¼klenince bu fonksiyon Ã§alÄ±ÅŸsÄ±n
        document.addEventListener('DOMContentLoaded', loadSystemSettings);

        async function loadSystemSettings() {
            try {
                const res = await fetch(`${API_URL}/settings`);
                const data = await res.json();

                // BakÄ±m Modu AnahtarÄ±nÄ± (Toggle) Bul ve Durumunu Ayarla
                const toggle = document.getElementById('maintenanceToggle');
                if (toggle && data.maintenance !== undefined) {
                    toggle.checked = data.maintenance;
                }

            } catch (e) {
                console.error("Sistem ayarlarÄ± yÃ¼klenemedi:", e);
            }
        }

        // "AyarlarÄ± Kaydet" Butonuna BasÄ±lÄ±nca Ã‡alÄ±ÅŸacak Fonksiyon
        async function saveSystemSettings() {
            const token = localStorage.getItem('userToken');

            // Sadece bakÄ±m modunun durumunu alÄ±yoruz
            const isMaintenanceOn = document.getElementById('maintenanceToggle').checked;

            try {
                const res = await fetch(`${API_URL}/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    // Sadece maintenance bilgisini gÃ¶nderiyoruz ($set sayesinde diÄŸerleri silinmez)
                    body: JSON.stringify({ maintenance: isMaintenanceOn })
                });

                if (res.ok) {
                    alert(isMaintenanceOn ? "Site BakÄ±ma AlÄ±ndÄ±! ğŸš§" : "Site YayÄ±na AÃ§Ä±ldÄ±! ğŸŒ");
                } else {
                    alert("Hata oluÅŸtu.");
                }
            } catch (e) {
                alert("Sunucu hatasÄ±.");
            }
        }
        // --- DOSYA YÃœKLEME GÃ–RSEL ETKÄ°LEÅÄ°MÄ° ---
        // Input ve YazÄ± AlanÄ±nÄ± Bul
        const fileInput = document.getElementById('bookCoverInput');
        const fileLabelText = document.querySelector('.file-upload-label span');

        if (fileInput) {
            fileInput.addEventListener('change', function (e) {
                // SeÃ§ilen dosya varsa ismini al
                if (e.target.files && e.target.files[0]) {
                    // YazÄ±yÄ± dosya ismiyle deÄŸiÅŸtir
                    fileLabelText.textContent = "âœ… " + e.target.files[0].name;
                    fileLabelText.style.color = "var(--text-main)"; // Rengi beyaz yap
                }
            });
        }
        // ==========================================
        // ğŸ“Š DASHBOARD VERÄ°LERÄ°NÄ° Ã‡EK
        // ==========================================
        async function loadDashboardStats() {
            try {
                const res = await fetch(`${API_URL}/dashboard/stats`);
                const data = await res.json();

                // 1. SayÄ±larÄ± GÃ¼ncelle
                if (document.getElementById('statTotalUsers'))
                    document.getElementById('statTotalUsers').textContent = data.counts.users;

                if (document.getElementById('statTotalBlogs'))
                    document.getElementById('statTotalBlogs').textContent = data.counts.posts;

                if (document.getElementById('statTotalBooks'))
                    document.getElementById('statTotalBooks').textContent = data.counts.books;

                // 2. Son Hareketleri Listele
                const listEl = document.getElementById('activityList');
                if (listEl) {
                    listEl.innerHTML = ""; // Temizle

                    if (data.activities.length === 0) {
                        listEl.innerHTML = "<p style='color:gray;'>HenÃ¼z bir iÅŸlem yok.</p>";
                    } else {
                        data.activities.forEach(act => {
                            // Tarihi gÃ¼zelleÅŸtir
                            const date = new Date(act.date).toLocaleDateString("tr-TR");

                            listEl.innerHTML += `
                        <div style="display:flex; align-items:center; gap:15px; padding:12px; background:rgba(255,255,255,0.03); border-radius:8px; border-left: 4px solid ${act.color};">
                            <i class="${act.icon}" style="font-size:1.2rem; color:${act.color};"></i>
                            <div style="flex:1;">
                                <div style="font-size:0.95rem; color:var(--text-main);">${act.text}</div>
                                <div style="font-size:0.75rem; color:gray; margin-top:2px;">${date}</div>
                            </div>
                        </div>
                    `;
                        });
                    }
                }

            } catch (error) {
                console.error("Dashboard hatasÄ±:", error);
            }
            loadRecentActivities()
        }

        // ğŸ•µï¸â€â™‚ï¸ DEBUG MODLU SON HAREKETLER
        // --- GELÄ°ÅMÄ°Å HAREKET GEÃ‡MÄ°ÅÄ° YÃœKLEYÄ°CÄ° ---
        async function loadRecentActivities() {
            const listContainer = document.querySelector('.recent-activities-list');
            // HTML'deki listenin sÄ±nÄ±fÄ± 'recent-activities-list' olmalÄ± (div veya ul)

            if (!listContainer) return;

            listContainer.innerHTML = '<div style="text-align:center; padding:20px;">Veriler analiz ediliyor... â³</div>';

            try {
                // 1. Paralel Ä°stek At (Hem BloglarÄ± Hem KullanÄ±cÄ±larÄ± Ã‡ek)
                const [postsRes, usersRes] = await Promise.all([
                    fetch('/api/posts'),
                    fetch('/api/users')
                ]);

                const posts = await postsRes.json();
                const users = await usersRes.json();

                // 2. Verileri Ortak Bir Formata Ã‡evir
                let activities = [];

                // BloglarÄ± Ekle
                posts.forEach(post => {
                    activities.push({
                        type: 'blog',
                        title: post.title,
                        author: post.author || 'Anonim',
                        date: new Date(post.date),
                        icon: '<i class="ph ph-article"></i>', // Phosphor Icons
                        desc: 'Yeni bir yazÄ± yayÄ±nladÄ±'
                    });
                });

                // KullanÄ±cÄ±larÄ± Ekle
                users.forEach(user => {
                    activities.push({
                        type: 'user',
                        title: user.username,
                        author: 'Sistem',
                        date: new Date(user.createdAt || Date.now()), // createdAt yoksa ÅŸimdiyi al
                        icon: '<i class="ph ph-user-plus"></i>',
                        desc: 'AramÄ±za katÄ±ldÄ±'
                    });
                });

                // 3. Tarihe GÃ¶re SÄ±rala (En Yeni En Ãœstte)
                activities.sort((a, b) => b.date - a.date);

                // 4. Sadece Son 10 Hareketi GÃ¶ster
                const recentActivities = activities.slice(0, 10);

                // 5. HTML'i OluÅŸtur ve Bas
                let html = '<div class="activity-list">';

                recentActivities.forEach(act => {
                    // Tarihi gÃ¼zelleÅŸtir (Ã–rn: "Az Ã¶nce" veya "2 saat Ã¶nce")
                    const timeAgo = new Date(act.date).toLocaleString('tr-TR', {
                        hour: '2-digit', minute: '2-digit', day: 'numeric', month: 'short'
                    });

                    // Renk sÄ±nÄ±fÄ±nÄ± belirle
                    const colorClass = act.type === 'blog' ? 'act-blog' : 'act-user';

                    html += `
            <div class="activity-item">
                <div class="activity-icon ${colorClass}">
                    ${act.icon}
                </div>
                <div class="activity-details">
                    <span class="activity-title">${act.title}</span>
                    <div class="activity-meta">
                        <span>${act.desc}</span>
                        ${act.type === 'blog' ? `<span>â€¢ âœï¸ ${act.author}</span>` : ''}
                    </div>
                </div>
                <span class="activity-time">${timeAgo}</span>
            </div>
            `;
                });

                html += '</div>';
                listContainer.innerHTML = html;

            } catch (error) {
                console.error("Hareketler yÃ¼klenirken hata:", error);
                listContainer.innerHTML = '<div style="color:red; text-align:center;">Sunucuya ulaÅŸÄ±lamadÄ± (Server KapalÄ± ğŸ”´)</div>';
            }
        }

        // Sayfa yÃ¼klenince Ã§alÄ±ÅŸtÄ±r
        document.addEventListener('DOMContentLoaded', loadRecentActivities);
        // SAYFA YÃœKLENÄ°NCE Ã‡AÄIR (DiÄŸer load fonksiyonlarÄ±nÄ±n yanÄ±na ekle)
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardStats();
            loadRecentActivities()
            loadWidgets();
        });

        // ==========================================
        // ğŸ§­ KESÄ°N Ã‡Ã–ZÃœM: SEKME DEÄÄ°ÅTÄ°RME SÄ°STEMÄ°
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardStats(); // Ä°lk aÃ§Ä±lÄ±ÅŸta istatistikleri Ã§ek

            const tabs = {
                'btn-dashboard': 'page-dashboard',
                'btn-blog': 'page-blog',
                'btn-book': 'page-book',
                'btn-widget': 'page-widget',
                'btn-users': 'page-users',
                'btn-settings': 'page-settings'
            };

            for (const [btnId, pageId] of Object.entries(tabs)) {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        // GÃ¶rÃ¼nÃ¼mÃ¼ DeÄŸiÅŸtir
                        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');

                        btn.classList.add('active');
                        const targetPage = document.getElementById(pageId);
                        if (targetPage) targetPage.style.display = 'block';

                        // ğŸ”¥ VERÄ°LERÄ° TAZELE (Ã–nemli KÄ±sÄ±m)
                        if (pageId === 'page-blog') fetchPosts();       // BloglarÄ± Getir
                        if (pageId === 'page-book') fetchBooksFromDB(); // KitaplarÄ± Getir
                        if (pageId === 'page-users') loadUsers();       // KullanÄ±cÄ±larÄ± Getir
                    });
                }
            }
        });
        async function fetchPosts() {
            const tbody = document.getElementById('postsListBody');
            if (!tbody) return;

            try {
                const res = await fetch(`${API_URL}/posts`);
                const posts = await res.json();

                tbody.innerHTML = ''; // Temizle

                if (posts.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:gray;">HenÃ¼z yazÄ± yok.</td></tr>';
                    return;
                }

                posts.forEach(post => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>
                  <span>${post.title}</span>
              </td>
                <td>
                    <button class="action-btn delete-btn" onclick="deletePost('${post._id}')">
                        <i class="ph ph-trash"></i> Sil
                    </button>
                </td>
            `;
                    tbody.appendChild(tr);
                });

                // GÃ¼venli sayaÃ§
                const blogCountEl = document.getElementById('statTotalBlogs');
                if (blogCountEl) blogCountEl.innerText = posts.length;

            } catch (error) {
                console.log("Blog hatasÄ±:", error);
            }
        }
        async function fetchBooksFromDB() {
            const tbody = document.getElementById('booksListBody');
            if (!tbody) return;

            try {
                const res = await fetch(`${API_URL}/books`);
                const books = await res.json();

                tbody.innerHTML = '';

                if (books.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; color:gray;">Kitap yok.</td></tr>';
                    return;
                }

                books.forEach(book => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <img src="${book.cover}" style="width:30px; height:45px; object-fit:cover; border-radius:4px;">
                        <span>${book.title}</span>
                    </div>
                </td>
                <td>${book.author}</td>
                <td>
                    <button class="action-btn delete-btn" onclick="deleteBook('${book._id}')">
                        <i class="ph ph-trash"></i> Sil
                    </button>
                </td>
            `;
                    tbody.appendChild(tr);
                });

                // GÃ¼venli sayaÃ§
                const bookCountEl = document.getElementById('statTotalBooks');
                if (bookCountEl) bookCountEl.innerText = books.length;

            } catch (error) {
                console.log("Kitap hatasÄ±:", error);
            }
        }

        // ğŸ” DÃœZELTÄ°LMÄ°Å KULLANICI ARAMA FONKSÄ°YONU
        function searchUsers() {
            // 1. YazÄ±lanÄ± al
            const input = document.getElementById('userSearchInput');
            const filter = input.value.toLocaleLowerCase('tr'); // TÃ¼rkÃ§e karakter desteÄŸi (Ä° -> i)

            const tableBody = document.getElementById('usersTableBody');
            const rows = tableBody.getElementsByTagName('tr');

            // 2. SatÄ±rlarÄ± gez
            for (let i = 0; i < rows.length; i++) {
                // ğŸ‘‡ DÃœZELTME BURADA: SÃ¼tunlarÄ± 0 ve 1 yaptÄ±k
                const usernameCol = rows[i].getElementsByTagName('td')[0]; // 1. SÃ¼tun (KullanÄ±cÄ± AdÄ±)
                const emailCol = rows[i].getElementsByTagName('td')[1];    // 2. SÃ¼tun (Email)

                if (usernameCol || emailCol) {
                    const usernameText = usernameCol ? usernameCol.textContent || usernameCol.innerText : "";
                    const emailText = emailCol ? emailCol.textContent || emailCol.innerText : "";

                    // Ä°kisinden birinde geÃ§iyorsa gÃ¶ster
                    if (usernameText.toLocaleLowerCase('tr').indexOf(filter) > -1 ||
                        emailText.toLocaleLowerCase('tr').indexOf(filter) > -1) {
                        rows[i].style.display = "";
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        }


    </script>

</body>

</html>